---
# NeoSetup Ansible Edition - Main Installation Playbook
# The Matrix has you, Neo... let's set up your development environment

- name: "\U0001F3AD Welcome to the Matrix - NeoSetup Ansible Edition"
  hosts: all
  gather_facts: yes
  become: no
  vars:
    # Get the current operator or use default
    current_operator: "{{ neosetup_operator | default(default_operator) }}"
  pre_tasks:
    - name: "\U0001F50D Display operator selection"
      debug:
        msg: |
          ğŸ­ Selected Operator: {{ current_operator }}
          ğŸš€ Loading operator configurations...
    - name: "\U0001F4E6 Load base operator variables"
      include_vars: "../operators/base/vars.yml"
    - name: "\U0001F4E6 Load matrix operator variables (if applicable)"
      include_vars: "../operators/matrix/vars.yml"
      when: current_operator in ['matrix', 'jiveturkey']
    - name: "\U0001F4E6 Load jiveturkey operator variables (if applicable)"
      include_vars: "../operators/jiveturkey/vars.yml"
      when: current_operator == 'jiveturkey'
    - name: "\U0001F4E6 Load macos operator variables (if applicable)"
      include_vars: "../operators/macos/vars.yml"
      when: current_operator == 'macos'
    - name: "\U0001F4E6 Load windows_wsl operator variables (if applicable)"
      include_vars: "../operators/windows_wsl/vars.yml"
      when: current_operator == 'windows_wsl'
    - name: "\U0001F4E6 Load python_dev operator variables (if applicable)"
      include_vars: "../operators/python_dev/vars.yml"
      when: current_operator == 'python_dev'
    - name: "\U0001F4E6 Load nodejs_dev operator variables (if applicable)"
      include_vars: "../operators/nodejs_dev/vars.yml"
      when: current_operator == 'nodejs_dev'
    - name: "\U0001F4E6 Load go_dev operator variables (if applicable)"
      include_vars: "../operators/go_dev/vars.yml"
      when: current_operator == 'go_dev'
    - name: "âœ… Display loaded operator information"
      debug:
        msg: |
          ğŸ­ Operator: {{ current_operator }}
          ğŸ“‹ Description: {{ operators[current_operator].description |
              default('No description') }}
          ğŸ‘¤ Author: {{ operators[current_operator].author |
              default('Unknown') }}
          ğŸ¨ Theme: {{ operators[current_operator].theme | default('default') }}
          ğŸ”— Extends: {{ operators[current_operator].extends | default('none') }}
  roles:
    - role: common
      tags: [ 'common', 'always' ]
    - role: shell
      when: neosetup_configure_shell | default(true)
      tags: [ 'shell' ]
    - role: tmux
      when: neosetup_configure_tmux | default(true)
      tags: [ 'tmux' ]
    - role: tools
      when: neosetup_install_packages | default(true)
      tags: [ 'tools', 'packages' ]
    - role: docker
      when: neosetup_install_docker | default(false)
      tags: [ 'docker' ]
  post_tasks:
    - name: "\U0001F389 NeoSetup installation complete"
      debug:
        msg: |
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘        Welcome to the Matrix, Neo        â•‘
          â•‘     Your environment has been setup      â•‘
          â•‘          with {{ current_operator }} operator          â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          ğŸš€ Next steps:
          - Restart your shell or run: source ~/.zshrc
          - Start tmux: tmux new-session
          - Check installed tools: which eza bat btop ripgrep

          The red pill was the right choice! ğŸ’Š
