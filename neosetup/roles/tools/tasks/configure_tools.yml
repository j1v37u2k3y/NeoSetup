---
# Configure installed tools with operator-specific settings

- name: "📁 Create tools configuration directory"
  file:
    path: "{{ ansible_env.HOME }}/.config"
    state: directory
    mode: '0755'

# Configure bat (better cat)
- name: "🦇 Create bat configuration directory"
  file:
    path: "{{ ansible_env.HOME }}/.config/bat"
    state: directory
    mode: '0755'

- name: "🦇 Configure bat with Matrix theme"
  copy:
    content: |
      # Generated by NeoSetup Ansible
      # Bat configuration for {{ neosetup_operator }} operator
      --theme="TwoDark"
      --style="numbers,changes,header"
      --wrap="auto"
      --pager="less -FR"
    dest: "{{ ansible_env.HOME }}/.config/bat/config"
    mode: '0644'

# Configure ripgrep
- name: "🔍 Configure ripgrep"
  copy:
    content: |
      # Generated by NeoSetup Ansible
      # Ripgrep configuration for {{ neosetup_operator }} operator
      --max-columns=150
      --max-columns-preview
      --smart-case
      --hidden
      --glob=!.git/*
      --glob=!node_modules/*
      --glob=!.venv/*
      --colors=line:fg:green
      --colors=path:fg:blue
      --colors=match:fg:red
    dest: "{{ ansible_env.HOME }}/.ripgreprc"
    mode: '0644'

# Configure git to use delta (if available)
- name: "🔺 Configure git to use delta"
  ini_file:
    path: "{{ ansible_env.HOME }}/.gitconfig"
    section: "{{ item.section }}"
    option: "{{ item.option }}"
    value: "{{ item.value }}"
    create: yes
  loop:
    - { section: "core", option: "pager", value: "delta" }
    - { section: "interactive", option: "diffFilter", value: "delta --color-only" }
    - { section: "delta", option: "navigate", value: "true" }
    - { section: "delta", option: "light", value: "false" }
    - { section: "delta", option: "line-numbers", value: "true" }
    - { section: "merge", option: "conflictstyle", value: "diff3" }
    - { section: "diff", option: "colorMoved", value: "default" }
  when: neosetup_configure_git_delta | default(true)

# Matrix-specific tool configurations
- name: "🎭 Configure Matrix-themed tools"
  block:
    - name: "🎭 Create neofetch config directory"
      file:
        path: "{{ ansible_env.HOME }}/.config/neofetch"
        state: directory
        mode: '0755'

    - name: "🎭 Configure neofetch with Matrix theme"
      copy:
        content: |
          # Generated by NeoSetup Ansible
          # Neofetch config for {{ neosetup_operator }} operator
          print_info() {
              info "🎭 User" users
              info "💻 Host" model
              info "🖥️  OS" distro
              info "🏗️  Kernel" kernel
              info "📦 Packages" packages
              info "🐚 Shell" shell
              info "💾 Memory" memory
              prin "🔴💊" "Welcome to the Matrix"
          }
          ascii_distro="arch_small"
          ascii_colors=(2 2 2 2 2 2)
          image_backend="ascii"
        dest: "{{ ansible_env.HOME }}/.config/neofetch/config.conf"
        mode: '0644'
  when: operators[neosetup_operator].theme == 'matrix'

# JiveTurkey-specific configurations
- name: "🔥 Configure JiveTurkey power-user tools"
  block:
    - name: "⚙️ Configure custom environment variables"
      lineinfile:
        path: "{{ ansible_env.HOME }}/.{{ ansible_env.SHELL | basename }}rc"
        line: "export {{ item.key }}='{{ item.value }}'"
        create: yes
      loop:
        - { key: "RIPGREP_CONFIG_PATH", value: "{{ ansible_env.HOME }}/.ripgreprc" }
        - { key: "FZF_DEFAULT_COMMAND", value: "fd --type f --hidden --follow --exclude .git" }
        - { key: "FZF_DEFAULT_OPTS", value: "--height 40% --layout=reverse --border --color=fg:#00ff00,bg:#000000,hl:#ffffff" }
      when: neosetup_set_env_vars | default(true)
  when: neosetup_operator == 'jiveturkey'
